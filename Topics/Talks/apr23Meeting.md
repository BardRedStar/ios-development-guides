# Митинг 23 апреля

## Тема

~[Backgrounder](https://github.com/AgapovOne/Backgrounder)~ app

## MVVM + Stateful

> Actions from VM to VC, methods from VC to VM

State:

- Минимальный стейт описывает изменяемый UI слой
- Вью слой изменяется полностью, когда меняется стейт.
- Стейт вью можно подменять с помощью хардкода. Позволит тестировать с любыми данными Могут помочь протоколы, чтобы писать моки
- Никогда не меняем явно стейт снаружи. Только читаем. Изменения внутри ViewModel.

Actions:

- Избавляемся от кучи кложур/делегатов, объявляем с помощью енама и свитча
- Подписываемся в одном месте внутри контроллера, не зависим
- Описывает все кложуры, которые идут в VC

## ViewModel, ViewData, Model, ViewController, View

~ViewModel~ Бизнес логика, контроль над данными, изменение, запись, запросы.
~ViewData~ Описание Model в удобном виде для Вью слоя. Форматирование, сбор строк, контроль данных (Hashable, Equatable) always struct.
~Model~ Codable/JSONable. Иногда много лишних данных, очень сильно зависит от API.
~ViewController/View~ Полностью вью слой. Желательно без бизнес логики. Может быть представлен на основе State/ViewModel/минимального конфига. Вся логика встраивания/переходов/навигации выдается в виде публичного интерфейса

## Координаторы:

> Контроль над навигацией проекта, облегчение VC

Почему хорошо:

- Мы не зависимы от вью слоя. Когда нужно - подойдет и простой VC.
- Навигация управляется снаружи
- Роутер помогает с переходами и анимациями
- Переиспользование вьюконтроллеров в разных местах становится явным

Почему может не работать:

- ???

Не уверен насчет фабрик. Нужны будут, если нужно будет тестировать. А нам такое редко нужно из-за времени

## Либы

[Reusable)](https://github.com/AliSoftware/Reusable)
Стандарт для всех реюзов. Коллекции, таблицы, вьюшки, нибы. Позволяет в коде создавать вьюшки из нибов (loadFromNib, instantiate)
[Hero](https://github.com/lkzhao/Hero)
Настроил. Зум работает, фото из коллекции переходит в фото на вью контроллере. Простая настройка, но меньше контроля, поэтому результат может быть не самым предсказуемым
[DeepDiff](https://github.com/onmyway133/DeepDiff)
Удобно для таблицы, чтобы не переживать за релоад. Но есть проблемы. Видимо Hashable работает неправильно. Пока рано юзать в продакшене.
~Moya~
Стандарт для нетворкинга. Хорошо подходит RxProvider, когда понадобятся несколько запросов в очереди/параллельно. Хорошие надстройки над Observable, типа `filter()`, `map()`
[SwiftMessages](https://github.com/SwiftKickMobile/SwiftMessages)
Удобная настройка, явные вьюшки. Общий конфиг, несколько разных вьюх.
[Kingfisher](https://github.com/onevcat/Kingfisher)
Доступ к кэшу, дефолтный конфиг, получение изображения из кэша.

## Вопрос тестирования

> Почему в проекте почти нет тестов

Когда тесты работают отлично:

- Чистая функция - Input-output. никаких сайд эффектов
- Быстро запускаются, быстро прогоняются

Где можно воспользоваться:

- Легкие чистые методы/функции, которые должны работать ожидаемо всегда. Есть тесты - мы уверены в методе. Поменяли метод - поменяли тесты.

Почему не стал:

- MVVM/MVC весь модуль тестировать долго и сложно, это лучше делает ручное тестирование
- Все-равно долгий запуск проекта + симулятора для прогона мелких тестов (В сравнении с <10 сек в js)

Альтернатива: **Playgrounds**
Отлично подходит для абстрактных чистых функций/методов